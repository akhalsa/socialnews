<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Filtra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="fonts/genericons/genericons.css">
  <link rel="stylesheet" href="css/non-responsive.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script type="text/javascript">
        /*
         *  Start by loading the category structure
         *
         */
        var selected_top_index = 0;
        var selected_secondary_index = 0;
        var selected_third_index = -1;
        
        
        var category_structure;
        
        $.getJSON("/category", function(result){
            console.log("got cat structure of:  "+JSON.stringify(result, null, 4));
            category_structure = result;
            renderTopNav()
            
        });
        
        function renderTopNav() {
            top_nav_container = document.getElementById("top_level_nav");
            var top_options_string = "";
            
            $.each(category_structure, function(i, child){
                
                top_options_string += "<li";
                if (selected_top_index == i) {
                    top_options_string += " class=\"active\""
                    $( ".current-page" ).children("a").html(child.name);
                    //TODO: all neighbor elements get populated by child.chilren categories
                    $(".current-page").nextAll().remove();
                    var list_string = "";
                    var reverseable = child.children.slice();
                    $.each(reverseable.reverse(), function(j, second_level){
                        if (j == selected_secondary_index) {
                            console.log("j val: "+j+" has name "+second_level.name);
                            list_string += "<li id=\"sub-nav2\" ><div id=\"wrap-pr\" onclick=\"topChooser("+i+","+j+",-1)\"><a href=\"#\">"
                            list_string += second_level.name + "</a><a href=\"#\"><span class=\"genericon genericon-collapse\"></span></a></div>";
                            if (second_level.children.length>0) {
                                list_string += "<ul>"
                            }
                            $.each(second_level.children, function(k, third_level){
                                if (k == selected_third_index) {
                                    list_string += "<li class=\"current-sub\" onclick=\"topChooser("+i+","+j+","+k+")\"><a href=\"#\">"+third_level.name+"</a></li>";
                                }
                                list_string += "<li><a href=\"#\" onclick=\"topChooser("+i+","+j+","+k+")\">"+third_level.name+"</a></li>"; 
                            });
                            if (second_level.children.length>0) {
                                list_string += "</ul>";
                            }
                            list_string += "</li>";
                        
                        } else{
                            console.log("j val: "+j+" has name "+second_level.name);
                            list_string += "<li onclick=\"topChooser("+i+","+j+",-1)\"><a href=\"#\">"+second_level.name+"</a><a href=\"#\"><span class=\"genericon genericon-expand\"></span></a></li>";

                        }
                    });
                    $(".current-page").after(list_string);
                    
                    
                }
                top_options_string += " id=\"top_level_id_"+i+"\"><a href=\"#\">"+child.name+"</a></li>";
                
            });
            top_nav_container.innerHTML = top_options_string;
            

            
            
            $.each(category_structure, function(i, child){
               $("#top_level_id_"+i).click(function(){ topChooser(i, -1, -1); return false; }); 
            });
            
            
        }

        function topChooser(i, j, k) {
            console.log("got a call to top chooser with i:"+i+" j:"+j+" k:"+k);
            selected_secondary_index = j;
            selected_third_index = k;
            selected_top_index = i;
            renderTopNav();
        }

        window.onload = function (){
            
        }
  </script>
</head>

<body>
<!-- header start -->
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid top-nav">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand" href="#"><img src="images/logo.png" alt="Filtra" /></a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav" id="top_level_nav">
        <li class="active"><a href="#">Front Page</a></li>
        <li><a href="#">Technology</a></li>
        <li><a href="#">Sports</a></li>
        <li><a href="#">Travel</a></li>
        <li><a href="#">Politics</a></li>
        <li><a href="#">Travel</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#"><span class="glyphicon glyphicon-user"></span> Login</a></li>
        <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Register</a></li>
      </ul>
    </div>
  </div>
</nav>
<!-- header end -->
<!-- contents start -->
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-2 wrap-sub-nav">
      <ul id="nav-category" class="sub">
      	<li class="current-page"><a href="#">Sports</a></li>
        <li id="sub-nav2"><div id="wrap-pr"><a href="#">Apple</a><a href="#"><span class="genericon genericon-collapse"></span></a></div>
        	<ul>
            	<li><a href="#">iOS</a></li>
                <li class="current-sub"><a href="#">OS X</a></li>
                <li><a href="#">Watch</a></li>
                <li><a href="#">TV</a></li>
                <li><a href="#">iPhone</a></li>
            </ul>
        </li>
        
        <li><a href="#">Google</a><a href="#"><span class="genericon genericon-expand"></span></a></li>
        <li><a href="#">Microsoft</a><a href="#"><span class="genericon genericon-expand"></span></a></li>
        <li><a href="#">Mobile</a><a href="#"><span class="genericon genericon-expand"></span></a></li>
        <li><a href="#">Game</a><a href="#"><span class="genericon genericon-expand"></span></a></li>
        <li><a href="#">Home</a><a href="#"><span class="genericon genericon-expand"></span></a></li>
        <li class="last-sub"><a href="#">Apps</a><a href="#"><span class="genericon genericon-expand"></span></a></li>
      </ul>
    </div>
    <div class="col-xs-8 col-xs-offset-2 wrap-con-main">
    	<!-- time start -->
    	<ul id="time">
        	<li class="current"><a href="#"><span class="genericon genericon-time"></span> Past 15 Minutes</a><br/><span class="genericon genericon-downarrow"></span></li>
            <li><a href="#"><span class="genericon genericon-time"></span> Past Hour</a></li>
            <li><a href="#"><span class="genericon genericon-time"></span> Past 3 Hours</a></li>
            <li><a href="#"><span class="genericon genericon-time"></span> Today</a></li>
            <div class="clear"></div>
        </ul>
    	<!-- time end -->
        <!-- tweets start -->
        <div class="con-tw">
        	<div class="wrap-user">
            	<div class="user"><img src="images/ic-twitter.png" alt="TechCrunch" /> Tech Crunch</div>
                <div class="time-tw"><span class="genericon genericon-time"></span> 5 min</div>
                <div class="clear"></div>
            </div>
            <div class="wrap-con-tw">
            	20 new ways Facebook is eating the Internet <a href="#">http://on.tcrn.ch/l/ka9B</a>
            </div>
        </div>
        <!-- tweets end -->
        <!-- tweets start -->
        <div class="con-tw">
        	<div class="wrap-user">
            	<div class="user"><img src="images/ic-twitter.png" alt="TechCrunch" /> Tech Crunch</div>
                <div class="time-tw"><span class="genericon genericon-time"></span> 5 min</div>
                <div class="clear"></div>
            </div>
            <div class="wrap-con-tw">
            	20 new ways Facebook is eating the Internet <a href="#">http://on.tcrn.ch/l/ka9B</a>
                <div class="preview-tw">
                	<div class="ic-pr"><span class="genericon genericon-show"></span> Preview</div>
					<div class="span8">
                    	<a href="#">SportsCenter on Twitter</a>
                    	<p>Cavaliers guard J.R. Smith crosses over Pacers forward Paul George, sending him to the floor and knocks down the jumper.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- tweets end -->
        <!-- tweets start -->
        <div class="con-tw">
        	<div class="wrap-user">
            	<div class="user"><img src="images/ic-twitter.png" alt="TechCrunch" /> Tech Crunch</div>
                <div class="time-tw"><span class="genericon genericon-time"></span> 5 min</div>
                <div class="clear"></div>
            </div>
            <div class="wrap-con-tw">
            	20 new ways Facebook is eating the Internet <a href="#">http://on.tcrn.ch/l/ka9B</a>
                <div class="preview-tw">
                	<div class="ic-pr"><span class="genericon genericon-show"></span> Preview</div>
					<div class="span8">
                    	<img src="images/img-sp.png"/>
                    	<a href="#">SportsCenter on Twitter</a>
                    	<p>Cavaliers guard J.R. Smith crosses over Pacers forward Paul George, sending him to the floor and knocks down the jumper. </p>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- tweets end -->
        <!-- tweets start -->
        <div class="con-tw">
        	<div class="wrap-user">
            	<div class="user"><img src="images/ic-twitter.png" alt="TechCrunch" /> Tech Crunch</div>
                <div class="time-tw"><span class="genericon genericon-time"></span> 5 min</div>
                <div class="clear"></div>
            </div>
            <div class="wrap-con-tw">
            	20 new ways Facebook is eating the Internet <a href="#">http://on.tcrn.ch/l/ka9B</a>
                <div class="preview-tw">
                	<div class="ic-pr"><span class="genericon genericon-show"></span> Preview</div>
					<div class="span8">
                    	<img src="images/img-sp.png"/>
                    	<a href="#">SportsCenter on Twitter</a>
                    	<p>Cavaliers guard J.R. Smith crosses over Pacers forward Paul George, sending him to the floor and knocks down the jumper.</p>
                        <div class="clear"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- tweets end -->
    </div>
  </div>
</div>
<!-- contents end -->
</body>
</html>