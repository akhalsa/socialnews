<html>
    <head>
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
        <script type="text/javascript" src="js/bootstrap-linkpreview.js"></script>
        <script type="text/javascript" src="js/proxy-ajax.js"></script>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="css/responsive.css">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap-linkpreview.css">
        
        <script type="text/javascript">
            $.getJSON('/reader/hi', function(result){
                var tweets = [];
                
                $.each(result, function(i, field){
                    
                    var finished = false;
                    
                    for	(index = 0; index < tweets.length; index++) {
                        
                        if ((parseInt(field.tweet_count) > parseInt(tweets[index].tweet_count)) &&(finished == false)) {
                            tweets.splice(index, 0, field);
                            finished = true;
                        }
                    }
                    
                    if (!finished) {
                        tweets.push(field);
                    }
                });
                
                tweet_list_element = document.getElementById("tweet_list");
                tweet_list_element.innerHTML = "";
                //console.log("tweet list length is: "+tweet_list.length);
                for (i=0; i<tweets.length; i++) {
                    //console.log("adding: "+tweet_list[i]);
                    var list_item = document.createElement('li');
                    list_item.setAttribute("id", "list_item_"+i);
                    list_item.appendChild(document.createTextNode(tweets[i].text+": "+tweets[i].tweet_count));
                    var div_item = document.createElement('div');
                    div_item.setAttribute("id", "div_item_"+i);
                    list_item.appendChild(div_item)
                    tweet_list_element.appendChild(list_item);
                    jQuery(list_item).linkpreview({
                        previewContainer: "#div_item_"+i,
                        url : "http://www.cnn.com/2015/08/23/europe/england-air-show-plane-crash/index.html",
                        preProcess: function() {
                            console.log("preProcess");
                        },
                        onSuccess: function() {
                            console.log("onSuccess");
                        },
                        onError: function() {
                            console.log("onError");
                        },
                        onComplete: function() {
                            console.log("onComplete");
                        }
                    });
                }

            });
            
            
        

        </script>
    </head>
    <body>
        <ul id="tweet_list">
        </ul>
    </body>
</html>
