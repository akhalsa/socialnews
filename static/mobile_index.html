
<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Filtra</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{static_url('css/bootstrap.min.css')}}">
  <link rel="stylesheet" href="{{static_url('css/mobile-style.css')}}">
  <link rel="stylesheet" href="{{static_url('fonts/genericons/genericons.css')}}">
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.14.3/ui-bootstrap-tpls.js" type="text/javascript"></script>
  <script src="{{static_url('js/filtraApp.js')}}"></script>
  <script src="{{static_url('js/filtraCtrl.js')}}"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    
    var tracking = getUrlParameter("tracking");
     /**
    * Function that tracks a click on an outbound link in Google Analytics.
    * This function takes a valid URL string as an argument, and uses that URL string
    * as the event label.
    */
    trackOutboundLink = function(url) {
        console.log("calling outbound: "+url);
        if( (typeof tracking == 'undefined')){
            ga('send', 'event', 'outbound', 'click', url, {'hitCallback':
                function () {
                }
            });
        }
       
    }
    
    function getUrlParameter(sParam) {
      var sPageURL = decodeURIComponent(window.location.search.substring(1)),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;
  
      for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
          return sParameterName[1] === undefined ? true : sParameterName[1];
        }
      }
    }
  </script>
</head>

<body ng-app="filtraApp" ng-controller="filtraCtrl"
  {% if 'cat_name' in globals() %}
      ng-init="category_name='{{cat_name}}'"
  {% end %}
>
<!-- header start -->
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid top-nav">
  	<!-- mobile button start -->
    <div id="bt-vote-top">
    	<a href="#" ng-click="toggleVotes()">Vote</a>
    </div>
    <!-- mobile button end -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" ng-init="navCollapsed = true" ng-click="navCollapsed = !navCollapsed" >
        <span class="genericon genericon-menu"></span>                     
      </button>
      <a class="navbar-brand" href="#"><img src="{{static_url('images/logo.png')}}" alt="middle"  align="bottom" /></a> <p id="slogan">A brief summary of social media</p>
      <div class="clear"></div>
    </div>
       <ul id="bt-top-nominate">
      	<li id="bt-nom"><a href="#"><span class="genericon genericon-search"></span> Nominate</a></li>
        <li><span class="genericon genericon-checkmark"></span>{{! remaining_votes}} Votes left <a tabindex="0" class="box-popup-info" role="button" data-toggle="popover" data-trigger="focus" data-content="Lorem ipsum dolor sit amet, consectetuer adipiscing elit, sed diam nonummy"><span class="genericon genericon-help"></span></a></li>
        <div class="clear"></div>
      </ul>
      <div class="clear"></div>
    <div class="collapse navbar-collapse" uib-collapse="navCollapsed">
    <!-- nav start -->
    <ul class="nav navbar-nav">
      <li ng-hide="category_structure.length == 0" ng-repeat="cat in category_structure" ng-class="{'active': $index == selected_top_index}">
        <a href="#"  ng-click="selectionChange($index, -1, -1)">{{! cat.name }}</a>
      </li>
    </ul>
    </div>
    <!-- nav end -->
  </div>
</nav>
<!-- header end -->
<!-- contents start -->
<div class="container-fluid">
  <div class="row">
    <div class="col-xs-12 col-md-2 hidden-xs hidden-sm wrap-sub-nav">    
        <!-- Collect the nav links, forms, and other content for toggling -->
          <ul id="nav-category" class="sub">
		<li class="current-page" ng-click="selectionChange(selected_top_index, -1, -1)"><a href="#">{{! category_structure[selected_top_index].name }}</a></li>
		<li ng-hide="category_structure.length == 0 || selected_top_index==-1" ng-repeat="cat in category_structure[selected_top_index].children"
		  id="{{! $index==selected_secondary_index ? 'sub-nav2' : 'random_sub_id'+$index}}">
		
		    <div id="wrap-pr" ng-show="$index==selected_secondary_index"  >
		      <a href="#" ng-click="selectionChange(selected_top_index, $index, -1)">{{! cat.name }}</a>
		      <a href="#"><span class='genericon genericon-collapse'></span></a>
		    </div>
		    <ul ng-show="$index==selected_secondary_index && category_structure[selected_top_index].children[selected_secondary_index].children.length >0">
		      <li ng-repeat="subcat in category_structure[selected_top_index].children[selected_secondary_index].children"
			  ng-class="{'current-sub': $index==selected_third_index}">
			<a href="#" ng-click="selectionChange(selected_top_index, selected_secondary_index, $index)" >{{! subcat.name}}</a>
		      </li>
		    </ul>
		    <a href="#" ng-hide="$index==selected_secondary_index" ng-click="selectionChange(selected_top_index, $index, -1)">
		      {{! cat.name }}</a>
		    <a href="#" ng-hide="$index==selected_secondary_index"><span class="genericon genericon-expand"></span></a>
		</li>
          </ul>
    </div>
    <div class="col-xs-12 col-md-7 wrap-con-main pure-container" data-effect="pure-effect-push"">
	<ol class="breadcrumb">
	  <li ng-repeat="category in current_path | skipLastBreadcrumb">
            <a href="#"  ng-click="breadCrumbSelection($index)">
              <span ng-class="{'genericon genericon-home': $index==0}"></span>{{! category}}
            </a>
	  </li>
	  <li class="dropdown active sc-mobile" uib-dropdown ng-show="current_path.length > 0">

		<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" uib-dropdown-toggle>
			{{! current_path[current_path.length -1 ] }}
			<span class="caret"></span>
		</button>
		<ul class="dropdown-menu" uib-dropdown-menu aria-labelledby="dropdownMenu1">
			<li ng-repeat="cat in peer_categories" ng-click="breadCrumbSubSelect($index);"><a href="#">{{! cat.name }}</a></li>
		</ul>
		
	  </li>
	  <li class="active sc-desktop" ng-show="current_path.length > 0">{{! current_path[current_path.length -1 ] }}</li>
        </ol>
    	<!-- Breadcurmbs end -->
	
        <!-- Mobile time start -->
        <div class="wrap-drop-refresh">
            <div class="dropdown" uib-dropdown>
              <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" uib-dropdown-toggle>
                <span class="genericon genericon-time"></span> {{! time_frames[selected_time].text }}
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" uib-dropdown-menu aria-labelledby="dropdownMenu1">
		<li ng-repeat="time_frame in time_frames" ng-click="timeChange($index);">
			<a href="#"><span class="genericon genericon-time"></span> {{! time_frame.text }}</a>
		</li>
              </ul>
            </div>
            <div id="bt-refresh">
            	<a href="#"><span class="genericon genericon-refresh"></span> Refresh</a>
            </div>
            <div class="clear"></div>
        </div>
        <!-- Mobile time end -->
	
	<!-- time start -->
	<ul id="time">
          <li ng-repeat="time_block in time_frames" ng-class="{'current': $index==selected_time}" ng-click="timeChange($index)">
            <a href="#"><span class="genericon genericon-time"></span>{{! time_block.text}}</a>
            <br ng-show="$index==selected_time"><span class="genericon genericon-downarrow" ng-show="$index==selected_time"></span>            
          </li>
          <div class="clear"></div>
        </ul>
	<!-- time end -->
	
	<!-- tweets start -->
	<div class="con-tw" ng-repeat="tweet in tweet_array">
        	<div class="wrap-user">
            	<div class="user">
                  <div class="handle-main"><img src="{{! tweet.pic}}" alt="{{! tweet.name}}"/></div>
                    <ul class="nominate" ng-repeat="handle in handle_list | matchTwitterName : tweet.name"
                        ng-class="{'done-up': handle.vote_val > 0, 'done-down':handle.vote_val < 0}">
                      <li class="up-v" ng-click="voteForHandle(handle.handle, 1);"><a href="#" onclick="return false;"><span class="genericon genericon-collapse"></span></a> <span>{{! handle.upvotes }}</span></li>
                      <li class="down-v" ng-click="voteForHandle(handle.handle, -1);"><a href="#" onclick="return false;"><span class="genericon genericon-expand"></span></a> <span>{{! handle.downvotes }}</span></li>
                    </ul>
                    <div class="handle-name"> {{! tweet.name}} </div>
                  <div class="clear"></div>
                </div>
                <div class="time-tw"><span class="genericon genericon-twitter"></span> {{! tweet.tweet_count }} <span class="genericon genericon-time"></span>
                {{! convertSecondsToDeltaTime(tweet.seconds_since_posted) }}</div>
                <div class="clear"></div>
            </div>
            <div class="wrap-con-tw" >
              <span ng-bind-html="tweet.text | unsafeLink"></span>
              <div class="preview-tw" ng-show="tweet.blurb || tweet.img_url || tweet.title" >
                <div class="ic-pr"><span class="genericon genericon-show"></span> Preview</div>
                <div class="span8">
                    	<img src="{{! tweet.img_url}}" ng-show="tweet.img_url" width="150"/>
                        
                    	<a href="{{! tweet.link_url }}"  ng-click="trackOutboundPreviewLink(tweet.link_url)" target="_blank" ng-show="tweet.title">{{! tweet.title }}</a>
                        <a href="{{! tweet.link_url }}" ng-click="trackOutboundPreviewLink(tweet.link_url)" ng-hide="tweet.title" ng-bind-html="tweet.text | unsafeLink"></a>
                        
                        
                    	<p ng-show="tweet.blurb">{{! tweet.blurb }}</p>
                        <p ng-hide="tweet.blurb" ng-bind-html="tweet.text | unsafeLink"></p>
                        
                        <div class="clear"></div>
                </div>
              </div>
            </div>
        </div>
        <!-- tweets end -->
    </div>
    <!-- sidebar start -->
    <div class="col-xs-12 col-md-3 vote-wrap">
        <div class="vote-pp-title">
            <div id="bt-close"><a href="#"><span class="genericon genericon-close-alt"></span></a></div>
            <h3>Nominate a Handle</h3>
            <div id="p-handle">
                <div id="p-search"><span class="genericon genericon-search"></span> <input type="text" class="p-in-search" /></div>
                <!-- ul id="open-handle-list">
                    <li>@Con</li>
                    <li>@CNN_BreakingNews</li>
                    <li>@CNN_International</li>
                    <li>@Con_prime</li>
                    <li>@Last_Con</li>
                    <li>@News_Con</li>
                </ul -->
            </div>
        </div>
    	<!-- vote start -->
        <div class="box-side">
        	<h3>Vote <a tabindex="0" role="button" popover-trigger="mouseenter" popover-placement="right" uib-popover="Cast your vote to see more or less from the nominated handles below"><span class="genericon genericon-help"></span></a></h3>
		<ul id="list-vote">
			<li ng-repeat="handle in handle_list" ng-class="{'active': handle.tracked, 'none-active': !handle.tracked}" >
				<div class="handle">
				  <img src="{{! handle.profile_pic }}"/>
				  {{! handle.handle }}
				</div>
				
				<ul class="nominate" ng-class="{'done-up': handle.vote_val > 0, 'done-down':handle.vote_val < 0}" >
				  <li ng-class="{'up-v': handle.vote_val !=0}" ng-click="voteForHandle(handle.handle, 1); ">
				    <a href="#" onclick="return false;"><span class="genericon genericon-collapse"></span></a>
				    <span >{{! handle.upvotes}}</span>
				  </li>
				  <li ng-class="{'down-v': handle.vote_val !=0}" ng-click="voteForHandle(handle.handle, -1);">
				    <a href="#" onclick="return false;"><span class="genericon genericon-expand"></span></a>
				    <span >{{! handle.downvotes}}</span>
				  </li>
				</ul>
				<div class="clear"></div>
			</li>
            </ul>
        </div>
    	<!-- vote end -->
    </div>
    <!-- sidebar end -->
  </div>
</div>
<!-- contents end -->
</body>
</html>
